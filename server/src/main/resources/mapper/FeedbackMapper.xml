<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.course.system.mapper.FeedbackMapper">

    <resultMap id="FeedbackResultMap" type="com.course.system.entity.Feedback">
        <id column="feedback_id" property="feedbackId" jdbcType="VARCHAR"/>
        <result column="assignment_id" property="assignmentId" jdbcType="VARCHAR"/>
        <result column="student_id" property="studentId" jdbcType="VARCHAR"/>
        <result column="feedback_content" property="feedbackContent" jdbcType="VARCHAR"/>
        <result column="publish_time" property="publishTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="ResponseResultMap" type="com.course.system.entity.Response">
        <id column="response_id" property="responseId" jdbcType="VARCHAR"/>
        <result column="feedback_id" property="feedbackId" jdbcType="VARCHAR"/>
        <result column="teacher_id" property="teacherId" jdbcType="VARCHAR"/>
        <result column="response_content" property="responseContent" jdbcType="VARCHAR"/>
        <result column="publish_time" property="publishTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- Feedback Operations -->
    <insert id="insertFeedback" parameterType="com.course.system.entity.Feedback">
        INSERT INTO feedbacks (feedback_id, assignment_id, student_id, feedback_content, publish_time)
        VALUES (#{feedbackId}, #{assignmentId}, #{studentId}, #{feedbackContent}, #{publishTime})
    </insert>

    <select id="selectFeedbacksByAssignment" resultMap="FeedbackResultMap">
        SELECT * FROM feedbacks WHERE assignment_id = #{assignmentId} ORDER BY publish_time DESC
    </select>

    <!-- Response Operations -->
    <insert id="insertResponse" parameterType="com.course.system.entity.Response">
        INSERT INTO responses (response_id, feedback_id, teacher_id, response_content, publish_time)
        VALUES (#{responseId}, #{feedbackId}, #{teacherId}, #{responseContent}, #{publishTime})
    </insert>

    <select id="selectResponsesByFeedback" resultMap="ResponseResultMap">
        SELECT * FROM responses WHERE feedback_id = #{feedbackId} ORDER BY publish_time ASC
    </select>

</mapper>
